# Фрактальные моно-поли-репозитории

Организуем кодовую базу так, чтобы она легко и плавно масштабировалась от одной библиотеки, поддерживаемой одним человеком, до фрактальной экосистемы библиотек и приложений, поддерживаемой кучей команд из разных компаний.

## Типичный путь развития проекта

### Поли-репо

- Каждая библиотека в своём репозитории.
- Изменил зависимость - изволь опубликовать и обновить версии в зависимых.
- Зависимость от инфраструктуры при локальной разработке.
- Пуш в поли-репо не атомарен.

### Моно-репо

- Все библиотеки сваливаются в кучу в один репозиторий.
- Пуш всегда атомарен.
- Разработчики толкаются локтями, работая с одним репо.
- Трудности с разграничением прав доступа.
- Трудности с бранчеванием одной библиотеки без влияния на другие.
- Не помещается на локальной машине целиком - нужен спец тулинг.

### Мульти-моно-репо

- Каждой команде свой моно-репо.
- Работаешь и там, и там - получаешь проблемы поли-репо.
- С бранчеванием проблемы остаются.
- Пуш сноова не атомарен.

## Что ещё не так?

- Каждый переход - большая работа по изменению кода и тулинга.
- Решаются одни проблемы - открываются другие.
- Решаются другие - открываются первые.

## Моно-поли-репо

- Изначально репо одно.
- Директория разрослась - в отдельный репо.
- Рекурсивная декомпозиция порождает дерево репо.
- Сам код остаётся неизменным.
- Рабочее окружение отделено от кода и обновляется централизованно.
- Локальная разработка не зависит от инфраструктуры.
- Не засоряется реестр пакетов промежуточными версиями.
- Простой тулинг.
- Не фиксируются версии.

### Композиция

- `git submodules` - фикс ревизии
- `git merge-tree` - фикс ревизии
- `git clone` - последняя ревизия

# Заметки

- Два режима разработки: frozen (фикс версий), verless (отказ от версий). Почему не semver.
- Фрактальный вынос разросшихся компонент в отдельные подрепозитории. Автоустановка зависимостей из сторонних репозиториев. Чисто гит, без npm-репозиториев.
- Отделение кодовой базы от инструментария сборки. Все настройки сборки в отдельном репо. Сборка всех реп единым образом. Централизованный рефакторинг экосистемы.
- Непрерывная интеграция. Каскадная сборка зависимых проектов.
- Фрактальные микрофронтенды. вынос частей приложения в отдельные приложения, поддерживаемых отдельными командами, и прозрачная интеграция их в общее приложение.
- Безопасность стороннего кода: от надежды на авось до контроля доверия.

В основе всего подход MAM: https://habhub.hyoo.ru/#!author=nin-jin/repo=HabHub/article=18
Живьём это можно увидеть тут: https://github.com/orgs/hyoo-ru/repositories?type=all
Пример микрофронтенд портала из нескольких десятков приложений/репозиториев: https://moldevhack.github.io/psb_portal/
Про версионирование: https://github.com/hyoo-ru/mam_mol/wiki/SemVer-vs-VerLess

- Добавить проблемы с зависимостями какие встретили и как они решаются.
- Глянуть, что намутили в го-модулях.