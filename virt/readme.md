# Автоматическая виртуализация рендеринга произвольной вёрстки

Здравствуйте, меня зовут дмитрий Карловский и я.. каждый день делаю это.. виртуализирование интерфейсы. Я делал иерархические списки задач на 40К штук, редактор документов на 200 страниц, и даже запилил фреймворк, где виртуализация происходит автоматически. Короче, съел я на той теме собаку, кошку, хорька, енота и даже морскую свинку. Так что далее я расскажу как эффективно предоставлять пользователю огромные объёмы данных, почему вообще возникает такая необходимость, какие технологии нам с этим могут помочь, и почему Реакт не способен избавить нас от головной боли.

[Дмитрий Карловский @ HolyJS'20 Moscow](https://holyjs-moscow.ru/)

## Типичный цикл разработки

- Написали код
- Проверили в типличных условиях
- Пришли пользователи и всё заспамили

## Наивный рендеринг

- Медленная загрузка
- Жрём много памяти
- Плохая отзывчивость

## Оптимизации

- Упрощение вёрстки - асимптотика не меняется
- Виртуализация - ручные приседания
- Вирт-фреймворк - то, что надо

## Ручные оптимизации

- Пагинация
- Экспандеры
- Бесконечный скролл
- Вирт скролл

## Автоматические оптимизации

- Тайм слайсинг
- Прогрессивный рендеринг
- Ленивый рендеринг
- Виртуальный рендеринг

## Проблемы виртуализации

- Оценка будущих размеров
- Скачки контента
- Скачки скроллбара
- Перерисовка всего экрана

## Scroll Anchoring

- как работает
- как использовать
- где работает
- что делать, если не работает

## Оценка размеров

- Точная
- Минимальная
- Максимальная
- Усреднённая
- Последняя

## Когда обновляться

- onScroll
- IntersectionObserver
- requestAnimationFrame

## Долгая раскладка

```
contain: content // for scroller
transform: translateZ(0) // for it's content
```

## Составные компоненты

- Вертикальный список
- Горизонтальный список
- Стек наложения
- Горизонтальный список с переносами

## Объекты против функций

- Объект: одно состояние - много действий
- Функция: много состояний - одно действие

## Ортогональные ручки

- Узнать минимальные размеры
- Частично отрендерить содержимое
- Проверить соответствие поисковому запросу

...

Наконец, покажу демки, где можно будет увидеть:
- высокую скорость открытия
- высокую отзывчивость
- минимальное потребление памяти
Ну и про недостатки, конечно:
- скачки скроллбара в случае неточной оценки размеров
- слабая кроссбраузерность (в сафари фоллбек до ленивого рендеринга)
- поиск по странице
- прокрутка к элементу

В действии можно глянуть тут:
https://nin-jin.github.io/habrcomment/#article=423889
https://bench.hyoo.ru/#bench=https%3A%2F%2Fbench.hyoo.ru%2Flist%2F/sample=mol~react/sort=fill/count=10000
