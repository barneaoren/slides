# Слияние деревьев

## Документ

- 200 страниц
- 50K слов
- 300К символов

## Негативный сценарий

> Несколько клиентов в оффлайне внесли изменения и хотят синхронизоваться

## Описание дерева

- сверху вниз
- снизу вверх

## Разрешение конфликтов

- Ручное
- Автоматическое

## Оракул

- Сервер может хранить больше информации, чем клиенты
- Гарантирует сходимость состояний
- Единая точка отказа

## Алгоритмы синхронизации

### Лог состояний

- Full State Replacement
- ConVergent Replicated Data Type

### Лог операций

- Operational Transformation
- CoMutative Replicated Data Type

### Лог изменений

- Difference Stream
- Delta Replicated Data Type

### Выбор алгоритма

| Свойство | FSR | CvRDT | OT | CmRDT | DS | dRDT
|----------|-----|-------|----|-------|----|------
| Оракул не обязателен | ❌ | ✅ | ✅ | ✅ | ✅ | ✅
| Непересекающиеся правки сливаются без потерь | ❌ | ✅ | ✅ | ✅ | ✅ | ✅
| Независимость хранимого объёма от числа изменений | ✅ | ✅ | ❌ | ❌ | ✅ | ❌
| Независимость хранимого объёма от числа пиров | ✅ | ❌ | ✅ | ✅ | ✅ | ❌
| Порядок прихода событий не важен | ❌ | ✅ | ❌ | ✅ | ❌ | ✅
| Независимость размера события от размера документа | ❌ | ❌ | ✅ | ✅ | ✅ | ✅
| Допустимость потери промежуточных событий | ✅ | ✅ | ❌ | ❌ | ✅ | ✅
