# Деконструкция аббревиатур

Здравствуйте, меня зовут Дим. А вы на канале "Core Dump", где мы берём разные темы из компьютерной науки и деконструируем их по полочкам.

> **TDD** SRP OCP LSP ISP DIP SOLID DRY KISS

Вы можете [открыть в интерфейсе проведения презентаций](https://nin-jin.github.io/slides/abbr/).

## Деконструкция TDD

Начнём мы с разработки через тестирование.

> Test Driven Development

Суть этого подхода заключается в ритуализации процесса разработки. То есть в некритическом безусловном выполнении определённых простых действий. Этот ритуал должен привести вас ко красивому, легко поддерживаемому, содержащему минимум дефектов коду. Так во всяком случае настоятельно убеждают нас проповедники TDD.

### Суть TDD

Вкратце, ритуальный цикл состоит из 3 шагов: сначала пишется красный тест; потом пишется или исправляется код так, чтобы тест позеленел; и наконец код рефакторится, сохраняя зеленоватость тестов.

![Pure TDD](https://habrastorage.org/webt/m7/wm/ts/m7wmts_olawooeqs5kcduncwgyy.png)

И тут сразу возникает вопрос впрос на миллион...

### Что делать, когда тест изначально зелёный?

Варианты ответов...

- Ломать код
- Удалять тест
- Это невозможно

А правильный ответ - все эти варианты не верные. Хотя именно один из них как правило слышишь от адептов TDD. И наоборот, подобные ответы редко можно услышать от тех, кто TDD не практикует.

### Парадокс воронов

Тут нельзя не упомянуть про парадокс воронов. Суть его в том, что задаётся вопрос: "Все ли вороны чёрные?". И для ответа на него берутся нечёрные предметы. Например - красные яблоки. И каждое такое яблоко как бы подтверждает тезис о том, что "все вороны чёрные", ведь яблоки не чёрные и при этом не вороны.

![](https://habrastorage.org/webt/uq/lh/ri/uqlhriwwnnffs1cqlkzmxhjczbi.jpeg)

Так же как в парадоксе воронов, адепт TDD нередко думает, что падение теста на явно некорректном коде может хоть что-то сказать о том, будет ли тест падать на коде, похожем на корректный. Однако, тут нет никакогой связи. Это просто два разных кода. Поломка и починка кода - это не более чем бессмысленное действие, необходимое только для того, чтобы форманьно пройти 2 обязательных шага ритуального цикла. Но насколько вероятна эта зелёная ситуация?

### Иначально зелёные тесты неизбежны

Даже для самой простой функции вам не хватит одного теста. Ведь надо рассмотреть позитивные и негативные сценарии, граничные условия, классы эквивалентности. Используя TDD вы сможете написать первый красный тест, другой, третий, но довольно быстро вы столкнётесь с ситуацией, что вы уже написали код, который удовлетворяет всем тест-кейсам, но собственно тестов вы написали меньше половины.

1. ❌ ⇝ ✅
2. ❌ ⇝ ✅
3. ❌ ⇝ ✅
4. ✅ ❓
5. ✅ ❓
6. ✅ ❓
7. ✅ ❓
8. ✅ ❓

Если мы оставим такие тесты, то это уже будет не TDD, ведь мы написали большую часть тестов уже после кода, а не до. Если же мы их удалим, то код останется попросту недотестированным. И на ближайшем рефакторинге мы скорее всего допустим дефект, который не будет обнаружен ввиду отсутствия теста для соответствующего кейса.

То есть, для обеспечения качества мы вынуждены явно нарушать основную идею TDD.

### Правильный TDD

Тем не менее, давайте попробуем представить, как мог бы выглядеть TDD здорового человека...

![Fixed TDD](https://habrastorage.org/webt/it/vp/ky/itvpky8gu9nq4_iiyisql-_n6zi.png)

### Лишняя работа при TDD

| Tests | Timeline | Code
|-------|----------|--------------------------
| 1     | ❌ ⇝ ✅ | `AAAAAA`
| 2     | ✅❌ ⇝ ❌❌ ⇝ ✅✅ | `BBBBBB`
| 3     | ✅✅❌ ⇝ ❌❌❌ ⇝ ✅✅✅ | `CCCCCC`
| 4     | ✅✅✅❌ ⇝ ✅✅❌❌ ⇝ ✅✅✅✅ | `CCCDDD`
| 5     | ✅✅✅✅❌ ⇝ ✅✅✅✅✅ | `CCCDDE`
| 6     | ✅✅✅✅✅❌ ⇝ ❌❌❌❌❌❌ ⇝ ✅✅✅✅✅✅ | `FFFFFF`

### Когда TDD полезен

- Исправление дефектов
- Заранее известный контракт
- Не заставить себя писать тесты

### Когда TDD вреден

- Reasearch

### Программировать ли по TDD?

- Ритуализация ❌
- Там, где это уместно ✅
- Не зацикливаться ✅
