# Алгоритмы консенсуса

## Документ

- 200 страниц
- 50K слов
- 300К символов

## Негативный сценарий

> Несколько клиентов в оффлайне внесли изменения и хотят синхронизоваться

## Описание дерева

- сверху вниз
- снизу вверх

## Разрешение конфликтов

- Ручное
- Автоматическое

## Автоматическое слияние

- Гарантия сходимости в конечном счёте
- Предсказуемый для пользователя результат
- Предугадать желания пользователей

## Оракул

- Сервер может хранить больше информации, чем клиенты
- Гарантирует сходимость состояний
- Единая точка отказа

## Алгоритмы синхронизации

| Что передаётся | Строгий порядок (Naive)    | Частичный порядок (CROWD) | Произвольный порядок (RDT)
|----------------|----------------------------|---------------------------|--------------------------------
| Состояния      | Full State Replacement     | CROWD Register/Sequence   | ConVergent Replicated Data Type
| Операции       | Operational Transformation |                           | CoMutative Replicated Data Type
| Разница        |                            | CROWD Dictionary          | Delta Replicated Data Type

### Full State Replacement
### ConVergent Replicated Data Type

### Operational Transformation
### CoMutative Replicated Data Type

### Difference Stream
### Delta Replicated Data Type

### Выбор алгоритма

| Свойство | FSR | OT | DS | CvRDT | CmRDT | dRDT
|----------|-----|-------|----|-------|----|------
| Непересекающиеся правки сливаются без потерь | ❌ | ✅ | ✅ | ✅ | ✅ | ✅
| Независимость хранимого объёма от числа изменений | ✅ | ❌ | ✅ | ✅ | ❌ | ❌
| Независимость хранимого объёма от числа пиров | ✅ | ✅ | ✅ | ❌ | ✅ | ❌
| Порядок прихода событий не важен | ❌ | ❌ | ❌ | ✅ | ✅ | ✅
| Стойкость к дублированию событий | ✅ | ❌ | ✅ | ✅ | ❌ | ❌
| Независимость размера события от размера документа | ❌ | ✅ | ✅ | ❌ | ✅ | ✅
| Время наложения патча не зависит от его древности | ✅ | ❌ | ✅ | ✅ | ✅ | ✅
