# Алгоритмы консенсуса

## Документ

- 200 страниц
- 50K слов
- 300К символов

## Негативный сценарий

> Несколько клиентов в оффлайне внесли изменения и хотят синхронизоваться

## Описание дерева

- сверху вниз
- снизу вверх

## Разрешение конфликтов

- Ручное
- Автоматическое

## Автоматическое слияние

- Гарантия сходимости в конечном счёте
- Предсказуемый для пользователя результат
- Предугадать желания пользователей

## Оракул

- Сервер может хранить больше информации, чем клиенты
- Гарантирует сходимость состояний
- Единая точка отказа

## Алгоритмы синхронизации

| Что передаётся | Последовательная обработка | Произвольный порядок
|----------------|----------------------------|---------------------
| Состояния      | Full State Replacement     | ConVergent Replicated Data Type
| Операции       | Operational Transformation | CoMutative Replicated Data Type
| Разница        | Difference Stream          | Delta Replicated Data Type

### Full State Replacement
### ConVergent Replicated Data Type

### Operational Transformation
### CoMutative Replicated Data Type

### Difference Stream
### Delta Replicated Data Type

### Выбор алгоритма

| Свойство | FSR | CvRDT | OT | CmRDT | DS | dRDT
|----------|-----|-------|----|-------|----|------
| Оракул не обязателен | ❌ | ✅ | ✅ | ✅ | ✅ | ✅
| Непересекающиеся правки сливаются без потерь | ❌ | ✅ | ✅ | ✅ | ✅ | ✅
| Независимость хранимого объёма от числа изменений | ✅ | ✅ | ❌ | ❌ | ✅ | ❌
| Независимость хранимого объёма от числа пиров | ✅ | ❌ | ✅ | ✅ | ✅ | ❌
| Порядок прихода событий не важен | ❌ | ✅ | ❌ | ✅ | ❌ | ✅
| Независимость размера события от размера документа | ❌ | ❌ | ✅ | ✅ | ✅ | ✅
| Допустимость потери промежуточных событий | ✅ | ✅ | ❌ | ❌ | ✅ | ✅
| Время наложения патча не зависит от его древности | ✅ | ✅ | ❌ | ✅ | ✅ | ✅
